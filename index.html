<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>üèÅ Concours Mario Kart ‚Äì Leclerc Marmoutier ‚úï Animeico</title>
  <style>
    body {
      font-family: 'Open Sans', sans-serif;
      background-color: #203451;
      color: #FFFFFF;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
      font-size: 2.5em;
      color: #FBB900;
    }
    .console {
      background-color: #2c4867;
      border-left: 5px solid #36A9E0;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 30px;
    }
    .console h3 {
      color: #36A9E0;
      font-size: 1.4em;
    }
    .podium {
      display: flex;
      justify-content: space-around;
      text-align: center;
      margin-top: 20px;
    }
    .player {
      background-color: #ffffff;
      color: #203451;
      padding: 15px;
      border-radius: 8px;
      width: 30%;
      box-shadow: 0 0 10px #00000044;
      animation: appear 0.8s ease-out;
    }
    .player:first-child {
      animation: bounce 1s ease-in-out 0.5s infinite alternate;
    }
    .rank {
      font-size: 2em;
    }
    @keyframes appear {
      from { transform: translateY(30px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    @keyframes bounce {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
  </style>
</head>
<body>
  <h1>üèÅ Concours Mario Kart</h1>
  <div id="leaderboards">Chargement des scores en direct...</div>

  <script>
    const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRU6XGT0W_GLOkrww4p6qalRKSS6fi2c4BKgoT7IUUdhzApBjlQopI2b4PfrLsIY2E9Sogu5WDZDlAN/pub?output=csv";

    function parseCSV(data) {
      const lines = data.trim().split("\n");
      const headers = lines[0].split(",");
      const rows = lines.slice(1).map(line => {
        const values = line.split(",");
        let obj = {};
        headers.forEach((header, i) => {
          obj[header.trim()] = values[i] ? values[i].trim() : "";
        });
        return obj;
      });
      return rows;
    }

    function parseTime(str) {
      const parts = str.split(":").map(Number);
      if (parts.length === 3) {
        const [min, sec, ms] = parts;
        return min * 60000 + sec * 1000 + ms;
      } else if (parts.length === 2) {
        const [min, sec] = parts;
        return min * 60000 + sec * 1000;
      } else if (parts.length === 1) {
        const [sec] = parts;
        return sec * 1000;
      } else {
        return Number.MAX_SAFE_INTEGER;
      }
    }

    fetch(SHEET_CSV_URL)
      .then(res => res.text())
      .then(data => {
        const entries = parseCSV(data);
        const grouped = {};

        entries.forEach(e => {
          const pseudo = e["Ton pseudo joueur (celui qui appara√Ætra dans)"];
          const console = e["Choisis ta console (et le circuit impos√©)"];
          const chrono = e["Ton meilleur temps (au format mm:ss:ms)"];
          if (!console || !pseudo || !chrono) return;
          if (!grouped[console]) grouped[console] = [];
          grouped[console].push({ pseudo, chrono, timeMs: parseTime(chrono) });
        });

        let html = "";
        for (const [console, players] of Object.entries(grouped)) {
          const top3 = players.sort((a, b) => a.timeMs - b.timeMs).slice(0, 3);
          html += `<div class="console"><h3>${console}</h3><div class="podium">`;
          top3.forEach((p, i) => {
            const medal = ["ü•á", "ü•à", "ü•â"][i];
            html += `<div class="player"><div class="rank">${medal}</div><div>${p.pseudo}</div><div>${p.chrono}</div></div>`;
          });
          html += "</div></div>";
        }
        document.getElementById("leaderboards").innerHTML = html || "<p style='text-align:center;'>Aucun score encore enregistr√©.</p>";
      })
      .catch(err => {
        console.error(err);
        document.getElementById("leaderboards").innerHTML = "<p style='text-align:center;'>Erreur de chargement des scores.</p>";
      });
  </script>
</body>
</html>

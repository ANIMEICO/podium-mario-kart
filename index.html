<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>üèÅ Concours Mario Kart ‚Äì Leclerc Marmoutier ‚úï Animeico</title>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Open Sans', sans-serif;
      background-color: #203451;
      color: #FFFFFF;
      margin: 0;
      padding: 20px;
    }

    h1 {
      text-align: center;
      font-size: 2.5em;
      margin-bottom: 10px;
      color: #FBB900;
    }

    h2 {
      text-align: center;
      font-size: 1.2em;
      color: #FFFFFF;
      margin-bottom: 30px;
    }

    .console {
      background-color: #2c4867;
      border-left: 5px solid #36A9E0;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 30px;
    }

    .console h3 {
      margin-top: 0;
      color: #36A9E0;
      font-size: 1.4em;
    }

    .podium {
      display: flex;
      justify-content: space-around;
      text-align: center;
      margin-top: 20px;
    }

    .player {
      background-color: #ffffff;
      color: #203451;
      padding: 15px;
      border-radius: 8px;
      width: 30%;
      box-shadow: 0 0 10px #00000044;
    }

    .rank {
      font-size: 2em;
    }

    .footer {
      margin-top: 50px;
      text-align: center;
      color: #575756;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  <h1>üèÅ Concours Mario Kart</h1>
  <h2>Leclerc Marmoutier ‚úï Animeico</h2>

  <div id="leaderboards">Chargement des scores en direct...</div>

  <div class="footer">L‚Äôanimation 2.0 ‚Äì Animeico</div>

  <script>
    const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRU6XGT0W_GLOkrww4p6qalRKSS6fi2c4BKgoT7IUUdhzApBjlQopI2b4PfrLsIY2E9Sogu5WDZDlAN/pub?output=csv";

    function parseCSV(data) {
      const lines = data.split("\\n");
      const headers = lines[0].split(",");
      const rows = lines.slice(1).map(line => {
        const values = line.split(",");
        let obj = {};
        headers.forEach((header, i) => {
          obj[header.trim()] = values[i] ? values[i].trim() : "";
        });
        return obj;
      });
      return rows;
    }

    function parseTime(str) {
      const [min, sec, ms] = str.split(":").map(Number);
      return min * 60000 + sec * 1000 + ms;
    }

    fetch(SHEET_CSV_URL)
      .then(res => res.text())
      .then(data => {
        const entries = parseCSV(data);
        const grouped = {};

        entries.forEach(e => {
          const pseudo = e["Ton pseudo joueur (celui qui appara√Ætra dans)"];
          const console = e["Choisis ta console (et le circuit impos√©)"];
          const chrono = e["Ton meilleur temps (au format mm:ss:ms)"];
          if (!console || !pseudo || !chrono) return;

          if (!grouped[console]) grouped[console] = [];
          grouped[console].push({ pseudo, chrono, timeMs: parseTime(chrono) });
        });

        let html = "";

        for (const [console, players] of Object.entries(grouped)) {
          const top3 = players.sort((a, b) => a.timeMs - b.timeMs).slice(0, 3);
          html += `<div class="console"><h3>${console}</h3><div class="podium">`;

          top3.forEach((p, i) => {
            const medal = ["ü•á", "ü•à", "ü•â"][i];
            html += `<div class="player"><div class="rank">${medal}</div><div>${p.pseudo}</div><div>${p.chrono}</div></div>`;
          });

          html += "</div></div>";
        }

        document.getElementById("leaderboards").innerHTML = html || "<p style='text-align:center;'>Aucun score encore enregistr√©.</p>";
      })
      .catch(err => {
        console.error(err);
        document.getElementById("leaderboards").innerHTML = "<p style='text-align:center;'>Erreur de chargement des scores.</p>";
      });
  </script>
</body>
</html>